*************************
API Reference
*************************



HTTP
=========================

+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Name          | Method | Descriptors   |                                                                                                                                                                                                                                                                                                                                                             |
+===============+========+===============+=============================================================================================================================================================================================================================================================================================================================================================+
| bzz           | GET    | Purpose       | retrieve document at domain/some/path allowing domain to resolve via the `Ethereum Name Service`_                                                                                                                                                                                                                                                           |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       | bzz:/<domain_part>/<resource_path>                                                                                                                                                                                                                                                                                                                          |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts | domain part: mandatory - ENS name or a valid swarm hash. path part: optional - a case insensitive path to match for in the manifest                                                                                                                                                                                                                         |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200; 300; 404; 500                                                                                                                                                                                                                                                                                                                                          |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with | The content stored at the resolved ENS entry (or the matched path) with the appropriate Content-Type as stored in the manifest                                                                                                                                                                                                                              |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               | POST   | Purpose       | post an application/x-tar or multipart/form-data (or any other Content-Type for that matter); create an appropriate manifest and retrieve the associated hash. if an existing manifest address is given with the according path to update - a copy of the manifest will be created with the updated entry and the hash of the new manifest will be returned |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       | bzz:/<manifest_hash?>/<resource_path?>/<encrypt?>                                                                                                                                                                                                                                                                                                           |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts | manifest hash - optional - an existing manifest address to update a resource included in the manifest. resource path - optional - which resource to update in the manifest. encrypt - optional flag to enable encryption                                                                                                                                    |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200                                                                                                                                                                                                                                                                                                                                                         |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with | a hash of a newly created manifest                                                                                                                                                                                                                                                                                                                          |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               | DELETE | Purpose       | delete a resource from a manifest by unlinking it from the existing manifest                                                                                                                                                                                                                                                                                |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       | bzz:/<domain>/<path>                                                                                                                                                                                                                                                                                                                                        |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts | domain part - mandatory - a valid ENS hash or a valid swarm manifest hash. path part - mandatory - a path to the resource to be removed from the manifest                                                                                                                                                                                                   |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200; 404; 500                                                                                                                                                                                                                                                                                                                                               |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with | the hash of the new manifest which does not have component ``path``                                                                                                                                                                                                                                                                                         |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bzz-immutable | GET    | Purpose       | The same as the generic scheme but there is no ENS domain resolution. the domain part of the path needs to be a valid hash. This is also a read-only scheme but explicit in its integrity protection. A particular bzz-immutable url will always necessarily address the exact same fixed immutable content.                                                |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       | bzz-immutable:/<hash>                                                                                                                                                                                                                                                                                                                                       |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts | hash part - a valid swarm hash that points to a manifest                                                                                                                                                                                                                                                                                                    |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200; 404; 500                                                                                                                                                                                                                                                                                                                                               |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with | the resolved content at the specified address with a valid content-type as stored in the manifest                                                                                                                                                                                                                                                           |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       | use bzz-hash to resolve the ens name into a hash then use it with immutable                                                                                                                                                                                                                                                                                 |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bzz-raw       | GET    | Purpose       | When responding to GET requests with the bzz-raw scheme swarm does not assume a manifest but just serves the asset addressed by the url directly. The ``content_type`` query parameter can be supplied to specify the mime type you are requesting otherwise content is served as an octet stream per default.                                              |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       | bzz-raw:/<content_hash>?content_type=<mime>                                                                                                                                                                                                                                                                                                                 |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts | content hash - mandatory - a valid swarm content hash. content type - optional - the mime type to serve the content as. defaults to application/octet-stream                                                                                                                                                                                                |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200; 404; 500                                                                                                                                                                                                                                                                                                                                               |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       | a pdf document (not the manifest wrapping it) resides at hash 6a182226... then the following url will properly serve it: GET http://localhost:8500/bzz-raw:/6a18222637cafb4ce692fa11df886a03e6d5e63432c53cbf7846970aa3e6fdf5?content_type=application/pdf                                                                                                   |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               | POST   | Purpose       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200; 404; 500                                                                                                                                                                                                                                                                                                                                               |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bzz-list      | GET    | Purpose       | Returns a list of all files contained in <manifest> under <path> grouped into common prefixes using ``/`` as a delimiter. If path is ``/`` - all files in manifest are returned. The response is a JSON-encoded object with ``common_prefixes`` string field and ``entries`` list field.                                                                    |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       | bzz-list:/<domain>/<path>                                                                                                                                                                                                                                                                                                                                   |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts | domain part - mandatory - a valid ENS entry that points to a valid manifest hash or a valid manifest hash. path part - optional - path to look for inside the manifest                                                                                                                                                                                      |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200; 404; 500                                                                                                                                                                                                                                                                                                                                               |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bzz-hash      | GET    | Purpose       | responds with the hash value of the raw content - the same content returned by requests with bzz-raw scheme. Hash of the manifest is also the hash stored in ENS so bzz-hash can be used for ENS domain resolution                                                                                                                                          |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       | bzz-hash:/<domain>                                                                                                                                                                                                                                                                                                                                          |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts | domain part - mandatory. a valid ENS name                                                                                                                                                                                                                                                                                                                   |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200; 404; 500                                                                                                                                                                                                                                                                                                                                               |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with | text/plain                                                                                                                                                                                                                                                                                                                                                  |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+



GET http://localhost:8500/bzz:/domain/some/path
  retrieve document at domain/some/path allowing domain to resolve via the `Ethereum Name Service`_

GET http://localhost:8500/bzz-immutable:/HASH/some/path
  retrieve document at HASH/some/path where HASH is a valid swarm hash

GET http://localhost:8500/bzz-raw:/domain/some/path
  retrieve the raw content at domain/some/path allowing domain to resolve via the `Ethereum Name Service`_

POST http://localhost:8500/bzz:
  The post request is the simplest upload method. Direct upload of files - no manifest is created.
  It returns the hash of the uploaded file

POST http://localhost:8500/bzz:/encrypt
  The post request is the simplest upload method. Direct upload of files - no manifest is created.
  It returns the hash of the uploaded file

POST http://localhost:8500/bzz-raw:
  The post request is the simplest upload method. Direct upload of files - no manifest is created.
  It returns the hash of the uploaded file

POST http://localhost:8500/bzz-raw:/encrypt
  The post request is the simplest upload method. Direct upload of files - no manifest is created.
  It returns the hash of the uploaded file

PUT http://localhost:8500/bzz:/HASH|domain/some/path
  The PUT request publishes the uploaded asset to the manifest. 
  It looks for the manifest by domain or hash, makes a copy of it and updates its collection with the new asset.
  It returns the hash of the newly created manifest.

Javascript
========================
Swarm currently supports a Javascript API through the `swarm-js <https://github.com/MaiaVictor/swarm-js>`_ package which is available through `NPM <https://www.npmjs.com/package/swarm-js>`_ by issuing
the following command:

.. code-block:: none
  
  npm install swarm-js

Usage is as simple as:

.. code-block:: javascript

        const file = "test file"; // could also be an Uint8Array of binary data
        swarm.upload(file).then(hash => {
          console.log("Uploaded file. Address:", hash);
        })
        
.. code-block:: javascript

        const fileHash = "a5c10851ef054c268a2438f10a21f6efe3dc3dcdcc2ea0e6a1a7a38bf8c91e23";
        swarm.download(fileHash).then(array => {
          console.log("Downloaded file:", swarm.toString(array));
        });

.. note:: For the full documentation please refer to the `GitHub`_ page.

.. _GitHub: https://github.com/MaiaVictor/swarm-js

IPC
========================

Swarm exposes an IPC API under the ``bzz`` namespace.

.. note:: Note that this is not the recommended way for users or dapps to interact with swarm and is only meant for debugging ad testing purposes. Given that this module offers local filesystem access, allowing dapps to use this module or exposing it via remote connections creates a major security risk. For this reason ``swarm`` only exposes this api via local ipc (unlike geth not allowing websockets or http).

FUSE
---------

``swarmfs.mount(HASH|domain, mountpoint))``
  mounts swarm contents represented by a swarm hash or a ens domain name to the specified local directory. The local directory has to be writable and should be empty.
  Once this command is succesfull, you should see the contents in the local directory. The HASH is mounted in a rw mode, which means any change insie the directory will be automatically reflected in swarm. Ex: if you copy a file from somewhere else in to mountpoint, it is equvivalent of using a "swarm up <file>" command.    

``swarmfs.unmount(mountpoint)``
  This command unmounts the HASH|domain mounted in the specified mountpoint. If the device is busy, unmounting fails. In that case make sure you exit the process that is using the directory and try unmounting again.

``swarmfs.listmounts()``
  For every active mount, this command display three things. The mountpoint, start HASH supplied and the latest HASH. Since the HASH is mounted in rw mode, when ever there is a change to the file system (adding file, removing file etc), a new HASH is computed. This hash is called the latest HASH.




.. uncommentthisChequebook IPC API
.. uncommentthis------------------------------

.. uncommentthisSwarm also exposes an IPC API for the chequebook offering the followng methods:

.. uncommentthis``chequebook.balance()``
.. uncommentthis  Returns the balance of your swap chequebook contract in wei.
.. uncommentthis  It errors if no chequebook is set.

.. uncommentthis``chequebook.issue(beneficiary, value)``
.. uncommentthis  Issues a cheque to beneficiary (an ethereum address) in the amount of value (given in wei). The json structure returned can be copied and sent to beneficiary who in turn can cash it using ``chequebook.cash(cheque)``.
.. uncommentthis  It errors if no chequebook is set.

.. uncommentthis``chequebook.cash(cheque)``
.. uncommentthis  Cashes the cheque issued. Note that anyone can cash a cheque. Its success only depends on the cheque's validity and the solvency of the issuers chequbook contract up to the amount specified in the cheque. The tranasction is paid from your bzz base account.
.. uncommentthis  Returns the transaction hash.
.. uncommentthis  It errors if no chequebook is set or if your account has insufficient funds to send the transaction.

.. uncommentthis``chequebook.deposit(amount)``
.. uncommentthis  Transfers funds of amount  wei from your bzz base account to your swap chequebook contract.
.. uncommentthis  It errors if no chequebook is set  or if your account has insufficient funds.


BZZ Schemes
==============

Swarm offers 8 distinct URL schemes, each has a different use case.
In the following table you'll find the specifications of each.
A locator part that ends with a question mark is `optional` (e.g. ``resource_path?``).


bzz
-----

Example:


.. code-block:: none

    GET http://localhost:8500/bzz:/theswarm.test

The bzz scheme assumes that the domain part of the url points to a manifest. When retrieving the asset addressed by the url, the manifest entries are matched against the url path. The entry with the longest matching path is retrieved and served with the content type specified in the corresponding manifest entry.

Example:

.. code-block:: none

    GET http://localhost:8500/bzz:/2477cc8584cc61091b5cc084cdcdb45bf3c6210c263b0143f030cf7d750e894d/read

returns a readme.md file if the manifest at the given hash address contains such an entry.

If the manifest contains multiple entries to which the URL could be resolved, like, in the example above, the manifest has entries for `readme.md` and `reading-list.txt`, the API returns a HTTP response "300 Multiple Choices", indicating that the request could not be unambiguously resolved. A list of available entries is returned via HTTP or JSON.


This generic scheme supports name resolution for domains registered on the Ethereum Name Service
(ENS, see `Ethereum Name Service`). This is a read-only scheme meaning that it only supports GET requests and serves to retrieve content from swarm.


bzz-immutable
^^^^^^^^^^^^^^^^^^^^

.. code-block:: none

    GET http://localhost:8500/bzz-immutable:/2477cc8584cc61091b5cc084cdcdb45bf3c6210c263b0143f030cf7d750e894d

The same as the generic scheme but there is no ENS domain resolution, the domain part of the path needs to be a valid hash. This is also a read-only scheme but explicit in its integrity protection. A particular bzz-immutable url will always necessarily address the exact same fixed immutable content.

.. _bzz-raw:

bzz-resource
^^^^^^^^^^^^^^^^^^^^

``bzz-resource`` allows you to receive hash pointers to content that the ENS entry resolved to at different versions

bzz-resource://<id> - get latest update
bzz-resource://<id>/<n> - get latest update on period n
bzz-resource://<id>/<n>/<m> - get update version m of period n
<id> = ens name





bzz-raw
^^^^^^^^^^^^^^

.. code-block:: none

    GET http://localhost:8500/bzz-raw:/2477cc8584cc61091b5cc084cdcdb45bf3c6210c263b0143f030cf7d750e894d


When responding to GET requests with the bzz-raw scheme, swarm does not assume a manifest, just serves the asset addressed by the url directly.

The ``content_type`` query parameter can be supplied to specify the mime type you are requesting, otherwise content is served as an octet stream per default. For instance if you have a pdf document (not the manifest wrapping it) at hash ``6a182226...`` then the following url will properly serve it.

.. code-block:: none

    GET http://localhost:8500/bzz-raw:/6a18222637cafb4ce692fa11df886a03e6d5e63432c53cbf7846970aa3e6fdf5?content_type=application/pdf


Importantly and somewhat unusually for generic schemes, the raw scheme supports POST and PUT requests. This is a crucially important way in which swarm is different from the internet as we know it.

The possibility to POST makes swarm an actual cloud service, bringing upload functionality to your browsing.

In fact the command line tool ``swarm up`` uses the http proxy with the bzz raw scheme under the hood.

bzz-list
^^^^^^^^^^^^^^

.. code-block:: none

    GET http://localhost:8500/bzz-list:/2477cc8584cc61091b5cc084cdcdb45bf3c6210c263b0143f030cf7d750e894d/path

Returns a list of all files contained in <manifest> under <path> grouped into common prefixes using ``/`` as a delimiter. If path is ``/``, all files in manifest are returned. The response is a JSON-encoded object with ``common_prefixes`` string field and ``entries`` list field.

bzz-hash
^^^^^^^^^^^^^^

.. code-block:: none

    GET http://localhost:8500/bzz-hash:/theswarm.test


Swarm accepts GET requests for bzz-hash url scheme and responds with the hash value of the raw content, the same content returned by requests with bzz-raw scheme. Hash of the manifest is also the hash stored in ENS so bzz-hash can be used for ENS domain resolution.

Response content type is *text/plain*.
